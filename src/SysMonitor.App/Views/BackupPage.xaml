<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="SysMonitor.App.Views.BackupPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    Background="{StaticResource BackgroundBrush}"
    Loaded="Page_Loaded">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Page Header Banner -->
        <Border Grid.Row="0" Background="#000000" Padding="24" Margin="-24,-24,-24,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <StackPanel Grid.Column="0" VerticalAlignment="Center" Spacing="4">
                    <TextBlock Text="{x:Bind ViewModel.WizardTitle, Mode=OneWay}" Style="{StaticResource PageHeaderStyle}"
                               Foreground="{StaticResource PrimaryBrush}" HorizontalAlignment="Left"/>
                    <TextBlock Text="{x:Bind ViewModel.WizardSubtitle, Mode=OneWay}" Style="{StaticResource PageSubtitleStyle}"
                               Foreground="#AAFFFFFF" HorizontalAlignment="Left"/>
                </StackPanel>

                <Image Grid.Column="1" Source="ms-appx:///Assets/Home_Logo.png"
                       Height="80" VerticalAlignment="Center" HorizontalAlignment="Center" Stretch="Uniform"/>
            </Grid>
        </Border>

        <!-- Main Content -->
        <Grid Grid.Row="1" Margin="0,16,0,0">

            <!-- Home View (Step 0) -->
            <Grid Visibility="{x:Bind ViewModel.IsWizardMode, Mode=OneWay, Converter={StaticResource InvertBoolToVisibilityConverter}}">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="320"/>
                </Grid.ColumnDefinitions>

                <ScrollViewer Grid.Column="0" VerticalScrollBarVisibility="Auto">
                    <StackPanel Spacing="16" Margin="0,0,16,16">

                        <!-- Quick Actions -->
                        <StackPanel Spacing="8">
                            <StackPanel Style="{StaticResource SectionHeaderWithAccentStyle}">
                                <Border Style="{StaticResource AccentBarStyle}" Height="20"/>
                                <TextBlock Text="QUICK ACTIONS" Style="{StaticResource SectionHeaderStyle}" Margin="0"/>
                            </StackPanel>

                            <Grid ColumnSpacing="12">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>

                                <!-- New Backup -->
                                <Border Grid.Column="0" Style="{StaticResource CardStyle}" Padding="16">
                                    <Button Click="NewBackup_Click" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                                            Style="{StaticResource OutlinedButtonStyle}" Padding="16">
                                        <StackPanel Spacing="12" HorizontalAlignment="Center">
                                            <FontIcon Glyph="&#xE710;" FontSize="36" Foreground="{StaticResource PrimaryBrush}"/>
                                            <TextBlock Text="New Backup" FontSize="14" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                            <TextBlock Text="Create a new backup of your files" FontSize="11" Foreground="#888"
                                                       TextWrapping="Wrap" TextAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                </Border>

                                <!-- Create Restore Point -->
                                <Border Grid.Column="1" Style="{StaticResource CardStyle}" Padding="16">
                                    <Button Click="CreateRestorePoint_Click" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                                            Style="{StaticResource OutlinedButtonStyle}" Padding="16">
                                        <StackPanel Spacing="12" HorizontalAlignment="Center">
                                            <FontIcon Glyph="&#xE81C;" FontSize="36" Foreground="#4CAF50"/>
                                            <TextBlock Text="Restore Point" FontSize="14" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                            <TextBlock Text="Create a system restore point" FontSize="11" Foreground="#888"
                                                       TextWrapping="Wrap" TextAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                </Border>

                                <!-- Quick Backup Documents -->
                                <Border Grid.Column="2" Style="{StaticResource CardStyle}" Padding="16">
                                    <Button Click="QuickBackupDocs_Click" HorizontalAlignment="Stretch" VerticalAlignment="Stretch"
                                            Style="{StaticResource OutlinedButtonStyle}" Padding="16">
                                        <StackPanel Spacing="12" HorizontalAlignment="Center">
                                            <FontIcon Glyph="&#xE8B7;" FontSize="36" Foreground="#2196F3"/>
                                            <TextBlock Text="Quick Backup" FontSize="14" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                            <TextBlock Text="One-click Documents backup" FontSize="11" Foreground="#888"
                                                       TextWrapping="Wrap" TextAlignment="Center"/>
                                        </StackPanel>
                                    </Button>
                                </Border>
                            </Grid>
                        </StackPanel>

                        <!-- Backup History -->
                        <StackPanel Spacing="8">
                            <StackPanel Style="{StaticResource SectionHeaderWithAccentStyle}">
                                <Border Style="{StaticResource AccentBarStyle}" Height="20"/>
                                <TextBlock Text="BACKUP HISTORY" Style="{StaticResource SectionHeaderStyle}" Margin="0"/>
                            </StackPanel>

                            <Border Style="{StaticResource CardStyle}" Padding="0"
                                    Visibility="{x:Bind ViewModel.HasBackups, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                                <ListView ItemsSource="{x:Bind ViewModel.BackupHistory, Mode=OneWay}"
                                          SelectionMode="None" Background="Transparent">
                                    <ListView.ItemContainerStyle>
                                        <Style TargetType="ListViewItem">
                                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                                            <Setter Property="Padding" Value="12"/>
                                        </Style>
                                    </ListView.ItemContainerStyle>
                                    <ListView.ItemTemplate>
                                        <DataTemplate>
                                            <Grid ColumnSpacing="12">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <Border Grid.Column="0" Style="{StaticResource IconContainerStyle}" Width="40" Height="40">
                                                    <FontIcon Glyph="{Binding Icon}" FontSize="18"/>
                                                </Border>

                                                <StackPanel Grid.Column="1" VerticalAlignment="Center" Spacing="2">
                                                    <TextBlock Text="{Binding Name}" FontWeight="SemiBold"/>
                                                    <StackPanel Orientation="Horizontal" Spacing="8">
                                                        <TextBlock Text="{Binding FormattedDate}" FontSize="11" Foreground="#888"/>
                                                        <TextBlock Text="|" FontSize="11" Foreground="#666"/>
                                                        <TextBlock Text="{Binding FormattedSize}" FontSize="11" Foreground="#888"/>
                                                        <TextBlock Text="|" FontSize="11" Foreground="#666"/>
                                                        <TextBlock FontSize="11" Foreground="#888">
                                                            <Run Text="{Binding FileCount}"/>
                                                            <Run Text=" files"/>
                                                        </TextBlock>
                                                    </StackPanel>
                                                </StackPanel>

                                                <Border Grid.Column="2" CornerRadius="4" Padding="8,4" Background="#202020" VerticalAlignment="Center">
                                                    <TextBlock Text="{Binding TypeDisplay}" FontSize="10" Foreground="#AAA"/>
                                                </Border>

                                                <StackPanel Grid.Column="3" Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                                                    <Button Click="RestoreBackup_Click" Tag="{Binding}" ToolTipService.ToolTip="Restore" Padding="8">
                                                        <FontIcon Glyph="&#xE777;" FontSize="14"/>
                                                    </Button>
                                                    <Button Click="DeleteBackup_Click" Tag="{Binding}" ToolTipService.ToolTip="Delete" Padding="8">
                                                        <FontIcon Glyph="&#xE74D;" FontSize="14" Foreground="#F44336"/>
                                                    </Button>
                                                </StackPanel>
                                            </Grid>
                                        </DataTemplate>
                                    </ListView.ItemTemplate>
                                </ListView>
                            </Border>

                            <Border Style="{StaticResource CardStyle}" Padding="24"
                                    Visibility="{x:Bind ViewModel.HasBackups, Mode=OneWay, Converter={StaticResource InvertBoolToVisibilityConverter}}">
                                <StackPanel HorizontalAlignment="Center" Spacing="8">
                                    <FontIcon Glyph="&#xE8B7;" FontSize="32" Foreground="#666"/>
                                    <TextBlock Text="No backups yet" FontSize="14" Foreground="#888" HorizontalAlignment="Center"/>
                                    <TextBlock Text="Create your first backup to protect your files" FontSize="12" Foreground="#666" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                        </StackPanel>

                        <!-- Restore Points -->
                        <StackPanel Spacing="8">
                            <StackPanel Style="{StaticResource SectionHeaderWithAccentStyle}">
                                <Border Style="{StaticResource AccentBarStyle}" Height="20"/>
                                <TextBlock Text="SYSTEM RESTORE POINTS" Style="{StaticResource SectionHeaderStyle}" Margin="0"/>
                            </StackPanel>

                            <Border Style="{StaticResource CardStyle}" Padding="12"
                                    Visibility="{x:Bind ViewModel.HasRestorePoints, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                                <ItemsControl ItemsSource="{x:Bind ViewModel.RestorePoints, Mode=OneWay}">
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate>
                                            <Grid Margin="0,4" ColumnSpacing="12">
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                    <ColumnDefinition Width="Auto"/>
                                                </Grid.ColumnDefinitions>

                                                <FontIcon Grid.Column="0" Glyph="&#xE81C;" FontSize="14" Foreground="#4CAF50"/>
                                                <TextBlock Grid.Column="1" Text="{Binding Description}" VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="2" Text="{Binding CreationTime}" FontSize="11" Foreground="#888" VerticalAlignment="Center"/>
                                            </Grid>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                            </Border>

                            <Border Style="{StaticResource CardStyle}" Padding="16"
                                    Visibility="{x:Bind ViewModel.HasRestorePoints, Mode=OneWay, Converter={StaticResource InvertBoolToVisibilityConverter}}">
                                <TextBlock Text="No restore points found. Click 'Restore Point' to create one."
                                           FontSize="12" Foreground="#888" HorizontalAlignment="Center"/>
                            </Border>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>

                <!-- Right Sidebar - Status -->
                <Border Grid.Column="1" Background="#141414" CornerRadius="8" Padding="16">
                    <StackPanel Spacing="16">
                        <TextBlock Text="BACKUP STATUS" FontWeight="SemiBold" Foreground="#888"/>

                        <!-- Last Backup Info -->
                        <Border Background="#1A1A1A" CornerRadius="6" Padding="12">
                            <StackPanel Spacing="8">
                                <TextBlock Text="Last Backup" FontSize="11" Foreground="#888"/>
                                <TextBlock Text="Documents_Backup" FontWeight="SemiBold"/>
                                <TextBlock Text="2 hours ago" FontSize="12" Foreground="#4CAF50"/>
                            </StackPanel>
                        </Border>

                        <!-- Storage Overview -->
                        <StackPanel Spacing="8">
                            <TextBlock Text="AVAILABLE DRIVES" FontWeight="SemiBold" Foreground="#888"/>
                            <ItemsControl ItemsSource="{x:Bind ViewModel.AvailableDrives, Mode=OneWay}">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="#1A1A1A" CornerRadius="6" Padding="12" Margin="0,4">
                                            <StackPanel Spacing="6">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto"/>
                                                        <ColumnDefinition Width="*"/>
                                                    </Grid.ColumnDefinitions>
                                                    <FontIcon Grid.Column="0" Glyph="{Binding Icon}" FontSize="18" Margin="0,0,8,0"/>
                                                    <StackPanel Grid.Column="1">
                                                        <TextBlock Text="{Binding Label}" FontWeight="SemiBold" FontSize="12"/>
                                                        <TextBlock Text="{Binding Path}" FontSize="10" Foreground="#888"/>
                                                    </StackPanel>
                                                </Grid>
                                                <ProgressBar Value="{Binding UsedPercent}" Maximum="100" Height="4" CornerRadius="2"/>
                                                <StackPanel Orientation="Horizontal" Spacing="4">
                                                    <TextBlock Text="{Binding FormattedFree}" FontSize="10" Foreground="#4CAF50"/>
                                                    <TextBlock Text="free of" FontSize="10" Foreground="#666"/>
                                                    <TextBlock Text="{Binding FormattedTotal}" FontSize="10" Foreground="#888"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>

                        <!-- Tips -->
                        <Border Background="#1A1A1A" CornerRadius="6" Padding="12">
                            <StackPanel Spacing="6">
                                <TextBlock Text="BACKUP TIPS" FontSize="11" FontWeight="SemiBold" Foreground="#888"/>
                                <TextBlock Text="&#x2022; Use USB drives for portable backups" FontSize="10" Foreground="#666" TextWrapping="Wrap"/>
                                <TextBlock Text="&#x2022; Create restore points before updates" FontSize="10" Foreground="#666" TextWrapping="Wrap"/>
                                <TextBlock Text="&#x2022; Schedule weekly backups for safety" FontSize="10" Foreground="#666" TextWrapping="Wrap"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Wizard Views -->
            <Grid Visibility="{x:Bind ViewModel.IsWizardMode, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">

                <!-- Step 1: Select Backup Type -->
                <StackPanel Spacing="16" Visibility="{x:Bind ViewModel.CurrentStep, Mode=OneWay, Converter={StaticResource IntEqualsOneToVisibilityConverter}}">
                    <TextBlock Text="What type of backup do you want to create?" FontSize="14" Foreground="#AAA"/>

                    <Grid ColumnSpacing="16">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <Button Grid.Row="0" Grid.Column="0" Click="SelectBackupType_Click" Tag="Full"
                                Style="{StaticResource OutlinedButtonStyle}" Padding="20" Margin="0,0,0,16"
                                HorizontalAlignment="Stretch" VerticalAlignment="Stretch" HorizontalContentAlignment="Left">
                            <StackPanel Orientation="Horizontal" Spacing="16">
                                <FontIcon Glyph="&#xE8F1;" FontSize="32" Foreground="{StaticResource PrimaryBrush}"/>
                                <StackPanel>
                                    <TextBlock Text="Full Backup" FontWeight="SemiBold" FontSize="16"/>
                                    <TextBlock Text="Complete backup of all selected files" FontSize="12" Foreground="#888"/>
                                </StackPanel>
                            </StackPanel>
                        </Button>

                        <Button Grid.Row="0" Grid.Column="1" Click="SelectBackupType_Click" Tag="Incremental"
                                Style="{StaticResource OutlinedButtonStyle}" Padding="20" Margin="0,0,0,16"
                                HorizontalAlignment="Stretch" VerticalAlignment="Stretch" HorizontalContentAlignment="Left">
                            <StackPanel Orientation="Horizontal" Spacing="16">
                                <FontIcon Glyph="&#xE8B2;" FontSize="32" Foreground="#4CAF50"/>
                                <StackPanel>
                                    <TextBlock Text="Incremental Backup" FontWeight="SemiBold" FontSize="16"/>
                                    <TextBlock Text="Only backup files changed since last backup" FontSize="12" Foreground="#888"/>
                                </StackPanel>
                            </StackPanel>
                        </Button>

                        <Button Grid.Row="1" Grid.Column="0" Click="SelectBackupType_Click" Tag="SystemImage"
                                Style="{StaticResource OutlinedButtonStyle}" Padding="20"
                                HorizontalAlignment="Stretch" VerticalAlignment="Stretch" HorizontalContentAlignment="Left">
                            <StackPanel Orientation="Horizontal" Spacing="16">
                                <FontIcon Glyph="&#xE770;" FontSize="32" Foreground="#2196F3"/>
                                <StackPanel>
                                    <TextBlock Text="System Image" FontWeight="SemiBold" FontSize="16"/>
                                    <TextBlock Text="Complete system backup for disaster recovery" FontSize="12" Foreground="#888"/>
                                </StackPanel>
                            </StackPanel>
                        </Button>

                        <Button Grid.Row="1" Grid.Column="1" Click="SelectBackupType_Click" Tag="Mirror"
                                Style="{StaticResource OutlinedButtonStyle}" Padding="20"
                                HorizontalAlignment="Stretch" VerticalAlignment="Stretch" HorizontalContentAlignment="Left">
                            <StackPanel Orientation="Horizontal" Spacing="16">
                                <FontIcon Glyph="&#xE8AB;" FontSize="32" Foreground="#FF9800"/>
                                <StackPanel>
                                    <TextBlock Text="Mirror Backup" FontWeight="SemiBold" FontSize="16"/>
                                    <TextBlock Text="Exact mirror of selected folders" FontSize="12" Foreground="#888"/>
                                </StackPanel>
                            </StackPanel>
                        </Button>
                    </Grid>

                    <!-- Navigation -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Spacing="8" Margin="0,24,0,0">
                        <Button Click="CancelWizard_Click" Style="{StaticResource OutlinedButtonStyle}" Content="Cancel" Padding="24,10"/>
                    </StackPanel>
                </StackPanel>

                <!-- Step 2: Select Source -->
                <StackPanel Spacing="16" Visibility="{x:Bind ViewModel.CurrentStep, Mode=OneWay, Converter={StaticResource IntEqualsTwoToVisibilityConverter}}">
                    <TextBlock Text="Select files and folders to backup:" FontSize="14" Foreground="#AAA"/>

                    <!-- Quick Add Buttons -->
                    <StackPanel Orientation="Horizontal" Spacing="8">
                        <Button Click="AddQuickSource_Click" Tag="Documents" Style="{StaticResource OutlinedButtonStyle}" Padding="12,8">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE8A5;" FontSize="14"/>
                                <TextBlock Text="Documents"/>
                            </StackPanel>
                        </Button>
                        <Button Click="AddQuickSource_Click" Tag="Pictures" Style="{StaticResource OutlinedButtonStyle}" Padding="12,8">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xEB9F;" FontSize="14"/>
                                <TextBlock Text="Pictures"/>
                            </StackPanel>
                        </Button>
                        <Button Click="AddQuickSource_Click" Tag="Videos" Style="{StaticResource OutlinedButtonStyle}" Padding="12,8">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE8B2;" FontSize="14"/>
                                <TextBlock Text="Videos"/>
                            </StackPanel>
                        </Button>
                        <Button Click="AddQuickSource_Click" Tag="Desktop" Style="{StaticResource OutlinedButtonStyle}" Padding="12,8">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE8FC;" FontSize="14"/>
                                <TextBlock Text="Desktop"/>
                            </StackPanel>
                        </Button>
                        <Button Click="AddQuickSource_Click" Tag="Downloads" Style="{StaticResource OutlinedButtonStyle}" Padding="12,8">
                            <StackPanel Orientation="Horizontal" Spacing="6">
                                <FontIcon Glyph="&#xE896;" FontSize="14"/>
                                <TextBlock Text="Downloads"/>
                            </StackPanel>
                        </Button>
                    </StackPanel>

                    <!-- Selected Sources List -->
                    <Border Style="{StaticResource CardStyle}" Padding="12" MinHeight="200">
                        <Grid>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto"/>
                                <RowDefinition Height="*"/>
                            </Grid.RowDefinitions>

                            <StackPanel Grid.Row="0" Orientation="Horizontal" Spacing="8" Margin="0,0,0,12">
                                <Button Click="AddSourceFolder_Click" Style="{StaticResource RedButtonStyle}" Padding="12,8">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <FontIcon Glyph="&#xE8F4;" FontSize="14"/>
                                        <TextBlock Text="Add Folder"/>
                                    </StackPanel>
                                </Button>
                                <Button Click="AddSourceFiles_Click" Style="{StaticResource OutlinedButtonStyle}" Padding="12,8">
                                    <StackPanel Orientation="Horizontal" Spacing="6">
                                        <FontIcon Glyph="&#xE8E5;" FontSize="14"/>
                                        <TextBlock Text="Add Files"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>

                            <ListView Grid.Row="1" ItemsSource="{x:Bind ViewModel.SourcePaths, Mode=OneWay}"
                                      SelectionMode="None" Background="Transparent">
                                <ListView.ItemTemplate>
                                    <DataTemplate x:DataType="x:String">
                                        <Grid ColumnSpacing="8">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto"/>
                                                <ColumnDefinition Width="*"/>
                                                <ColumnDefinition Width="Auto"/>
                                            </Grid.ColumnDefinitions>
                                            <FontIcon Grid.Column="0" Glyph="&#xE8B7;" FontSize="14" Foreground="#888"/>
                                            <TextBlock Grid.Column="1" Text="{x:Bind}" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
                                            <Button Grid.Column="2" Click="RemoveSource_Click" Tag="{x:Bind}" Padding="4"
                                                    Background="Transparent" ToolTipService.ToolTip="Remove">
                                                <FontIcon Glyph="&#xE711;" FontSize="12" Foreground="#F44336"/>
                                            </Button>
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </Grid>
                    </Border>

                    <!-- Estimated Size -->
                    <Border Background="#1A1A1A" CornerRadius="6" Padding="12">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE946;" FontSize="16" Foreground="#888"/>
                            <TextBlock Text="Estimated backup size:" Foreground="#888"/>
                            <TextBlock Text="{x:Bind ViewModel.FormattedEstimatedSize, Mode=OneWay}" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Border>

                    <!-- Navigation -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Spacing="8" Margin="0,24,0,0">
                        <Button Click="CancelWizard_Click" Style="{StaticResource OutlinedButtonStyle}" Content="Cancel" Padding="24,10"/>
                        <Button Click="PreviousStep_Click" Style="{StaticResource OutlinedButtonStyle}" Content="Back" Padding="24,10"/>
                        <Button Click="NextStep_Click" Style="{StaticResource RedButtonStyle}" Content="Next" Padding="24,10"/>
                    </StackPanel>
                </StackPanel>

                <!-- Step 3: Select Destination -->
                <StackPanel Spacing="16" Visibility="{x:Bind ViewModel.CurrentStep, Mode=OneWay, Converter={StaticResource IntEqualsThreeToVisibilityConverter}}">
                    <TextBlock Text="Choose where to save your backup:" FontSize="14" Foreground="#AAA"/>

                    <!-- Available Drives -->
                    <ItemsControl ItemsSource="{x:Bind ViewModel.AvailableDrives, Mode=OneWay}">
                        <ItemsControl.ItemsPanel>
                            <ItemsPanelTemplate>
                                <StackPanel Spacing="8"/>
                            </ItemsPanelTemplate>
                        </ItemsControl.ItemsPanel>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Button Click="SelectDrive_Click" Tag="{Binding}" HorizontalAlignment="Stretch"
                                        Style="{StaticResource OutlinedButtonStyle}" Padding="16" HorizontalContentAlignment="Stretch">
                                    <Grid ColumnSpacing="16">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>

                                        <FontIcon Grid.Column="0" Glyph="{Binding Icon}" FontSize="28"/>

                                        <StackPanel Grid.Column="1" Spacing="4">
                                            <StackPanel Orientation="Horizontal" Spacing="8">
                                                <TextBlock Text="{Binding Label}" FontWeight="SemiBold" FontSize="14"/>
                                                <TextBlock Text="{Binding Path}" FontSize="12" Foreground="#888"/>
                                            </StackPanel>
                                            <ProgressBar Value="{Binding UsedPercent}" Maximum="100" Height="4" CornerRadius="2"/>
                                            <TextBlock FontSize="11" Foreground="#888">
                                                <Run Text="{Binding FormattedFree}"/>
                                                <Run Text=" available"/>
                                            </TextBlock>
                                        </StackPanel>

                                        <FontIcon Grid.Column="2" Glyph="&#xE76C;" FontSize="14" Foreground="#666"/>
                                    </Grid>
                                </Button>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <Button Click="BrowseDestination_Click" Style="{StaticResource OutlinedButtonStyle}"
                            HorizontalAlignment="Stretch" Padding="16">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xED25;" FontSize="16"/>
                            <TextBlock Text="Browse for folder..."/>
                        </StackPanel>
                    </Button>

                    <!-- Selected Destination -->
                    <Border Background="#1A1A1A" CornerRadius="6" Padding="12"
                            Visibility="{x:Bind ViewModel.DestinationPath, Mode=OneWay, Converter={StaticResource StringNotEmptyToVisibilityConverter}}">
                        <StackPanel Orientation="Horizontal" Spacing="8">
                            <FontIcon Glyph="&#xE73E;" FontSize="16" Foreground="#4CAF50"/>
                            <TextBlock Text="Selected:" Foreground="#888"/>
                            <TextBlock Text="{x:Bind ViewModel.DestinationPath, Mode=OneWay}" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Border>

                    <!-- Navigation -->
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Spacing="8" Margin="0,24,0,0">
                        <Button Click="CancelWizard_Click" Style="{StaticResource OutlinedButtonStyle}" Content="Cancel" Padding="24,10"/>
                        <Button Click="PreviousStep_Click" Style="{StaticResource OutlinedButtonStyle}" Content="Back" Padding="24,10"/>
                        <Button Click="NextStep_Click" Style="{StaticResource RedButtonStyle}" Content="Next" Padding="24,10"/>
                    </StackPanel>
                </StackPanel>

                <!-- Step 4: Options -->
                <ScrollViewer Visibility="{x:Bind ViewModel.CurrentStep, Mode=OneWay, Converter={StaticResource IntEqualsFourToVisibilityConverter}}">
                    <StackPanel Spacing="16">
                        <TextBlock Text="Configure backup options:" FontSize="14" Foreground="#AAA"/>

                        <!-- Backup Name -->
                        <Border Style="{StaticResource CardStyle}" Padding="16">
                            <StackPanel Spacing="8">
                                <TextBlock Text="Backup Name" FontWeight="SemiBold"/>
                                <TextBox Text="{x:Bind ViewModel.BackupName, Mode=TwoWay}" PlaceholderText="Enter a name for this backup"/>
                            </StackPanel>
                        </Border>

                        <!-- Compression -->
                        <Border Style="{StaticResource CardStyle}" Padding="16">
                            <StackPanel Spacing="8">
                                <TextBlock Text="Compression" FontWeight="SemiBold"/>
                                <ComboBox x:Name="CompressionPicker" SelectedIndex="1" HorizontalAlignment="Stretch">
                                    <ComboBoxItem Content="None - Fastest, largest size" Tag="None"/>
                                    <ComboBoxItem Content="Normal - Balanced (Recommended)" Tag="Normal"/>
                                    <ComboBoxItem Content="Maximum - Smallest size, slower" Tag="Maximum"/>
                                </ComboBox>
                            </StackPanel>
                        </Border>

                        <!-- Encryption -->
                        <Border Style="{StaticResource CardStyle}" Padding="16">
                            <StackPanel Spacing="8">
                                <ToggleSwitch Header="Encrypt Backup" IsOn="{x:Bind ViewModel.EnableEncryption, Mode=TwoWay}"/>
                                <StackPanel Spacing="8" Visibility="{x:Bind ViewModel.EnableEncryption, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <PasswordBox Header="Password" Password="{x:Bind ViewModel.EncryptionPassword, Mode=TwoWay}" PlaceholderText="Enter encryption password"/>
                                    <PasswordBox Header="Confirm Password" Password="{x:Bind ViewModel.ConfirmPassword, Mode=TwoWay}" PlaceholderText="Confirm password"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Additional Options -->
                        <Border Style="{StaticResource CardStyle}" Padding="16">
                            <StackPanel Spacing="12">
                                <TextBlock Text="Additional Options" FontWeight="SemiBold"/>
                                <ToggleSwitch Header="Verify backup after completion" IsOn="{x:Bind ViewModel.VerifyAfterBackup, Mode=TwoWay}"/>
                                <ToggleSwitch Header="Include hidden files" IsOn="{x:Bind ViewModel.IncludeHiddenFiles, Mode=TwoWay}"/>
                                <ToggleSwitch Header="Use Volume Shadow Copy (backup files in use)" IsOn="{x:Bind ViewModel.UseVss, Mode=TwoWay}"/>
                            </StackPanel>
                        </Border>

                        <!-- Retention -->
                        <Border Style="{StaticResource CardStyle}" Padding="16">
                            <StackPanel Spacing="8">
                                <TextBlock Text="Retention Policy" FontWeight="SemiBold"/>
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <TextBlock Text="Keep last" VerticalAlignment="Center"/>
                                    <NumberBox Value="{x:Bind ViewModel.MaxBackupsToKeep, Mode=TwoWay}" Minimum="1" Maximum="100" SpinButtonPlacementMode="Compact"/>
                                    <TextBlock Text="backups" VerticalAlignment="Center"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>

                        <!-- Navigation -->
                        <StackPanel Orientation="Horizontal" HorizontalAlignment="Right" Spacing="8" Margin="0,24,0,16">
                            <Button Click="CancelWizard_Click" Style="{StaticResource OutlinedButtonStyle}" Content="Cancel" Padding="24,10"/>
                            <Button Click="PreviousStep_Click" Style="{StaticResource OutlinedButtonStyle}" Content="Back" Padding="24,10"/>
                            <Button Click="StartBackup_Click" Style="{StaticResource RedButtonStyle}" Padding="24,10">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE768;" FontSize="14"/>
                                    <TextBlock Text="Start Backup"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>

                <!-- Step 5: Progress -->
                <Grid Visibility="{x:Bind ViewModel.CurrentStep, Mode=OneWay, Converter={StaticResource IntEqualsFiveToVisibilityConverter}}">
                    <Border Style="{StaticResource CardStyle}" Padding="32" VerticalAlignment="Center" HorizontalAlignment="Center" MinWidth="500">
                        <StackPanel Spacing="24" HorizontalAlignment="Center">
                            <ProgressRing IsActive="True" Width="64" Height="64" Foreground="{StaticResource PrimaryBrush}"/>

                            <StackPanel Spacing="8" HorizontalAlignment="Center">
                                <TextBlock Text="{x:Bind ViewModel.ProgressStatus, Mode=OneWay}" FontSize="16" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                <TextBlock Text="{x:Bind ViewModel.CurrentFile, Mode=OneWay}" FontSize="12" Foreground="#888"
                                           HorizontalAlignment="Center" TextTrimming="CharacterEllipsis" MaxWidth="400"/>
                            </StackPanel>

                            <StackPanel Spacing="4">
                                <ProgressBar Value="{x:Bind ViewModel.ProgressPercent, Mode=OneWay}" Maximum="100" Height="8" CornerRadius="4"/>
                                <Grid>
                                    <TextBlock Text="{x:Bind ViewModel.ProcessedInfo, Mode=OneWay}" FontSize="11" Foreground="#888"/>
                                    <TextBlock Text="{x:Bind ViewModel.ProgressSpeed, Mode=OneWay}" FontSize="11" Foreground="#888" HorizontalAlignment="Right"/>
                                </Grid>
                            </StackPanel>

                            <TextBlock Text="{x:Bind ViewModel.ProgressEta, Mode=OneWay}" FontSize="12" Foreground="#4CAF50" HorizontalAlignment="Center"/>

                            <Button Click="CancelBackup_Click" Style="{StaticResource OutlinedButtonStyle}" Content="Cancel Backup" Padding="24,10" HorizontalAlignment="Center"/>
                        </StackPanel>
                    </Border>
                </Grid>

                <!-- Step 6: Complete -->
                <Grid Visibility="{x:Bind ViewModel.CurrentStep, Mode=OneWay, Converter={StaticResource IntEqualsSixToVisibilityConverter}}">
                    <Border Style="{StaticResource CardStyle}" Padding="32" VerticalAlignment="Center" HorizontalAlignment="Center" MinWidth="500">
                        <StackPanel Spacing="24" HorizontalAlignment="Center">
                            <FontIcon Glyph="{x:Bind ViewModel.ResultSuccess, Mode=OneWay, Converter={StaticResource BoolToSuccessGlyphConverter}}"
                                      FontSize="64" Foreground="{x:Bind ViewModel.ResultSuccess, Mode=OneWay, Converter={StaticResource BoolToSuccessColorConverter}}"/>

                            <StackPanel Spacing="8" HorizontalAlignment="Center">
                                <TextBlock Text="{x:Bind ViewModel.ResultMessage, Mode=OneWay}" FontSize="18" FontWeight="SemiBold" HorizontalAlignment="Center"/>
                                <TextBlock Text="{x:Bind ViewModel.ResultDetails, Mode=OneWay}" FontSize="12" Foreground="#888"
                                           HorizontalAlignment="Center" TextAlignment="Center"/>
                            </StackPanel>

                            <StackPanel Orientation="Horizontal" Spacing="8" HorizontalAlignment="Center">
                                <Button Click="CancelWizard_Click" Style="{StaticResource RedButtonStyle}" Content="Done" Padding="32,10"/>
                                <Button Click="NewBackup_Click" Style="{StaticResource OutlinedButtonStyle}" Content="New Backup" Padding="24,10"/>
                            </StackPanel>
                        </StackPanel>
                    </Border>
                </Grid>
            </Grid>
        </Grid>

        <!-- Status Toast -->
        <Border Background="{x:Bind ViewModel.StatusColor, Mode=OneWay, Converter={StaticResource StringToBrushConverter}}"
                CornerRadius="8" Padding="16,10" Margin="0,0,0,20"
                Visibility="{x:Bind ViewModel.HasStatusMessage, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
                VerticalAlignment="Bottom" HorizontalAlignment="Center" Grid.Row="1">
            <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}" Foreground="White" FontWeight="SemiBold" FontSize="13"/>
        </Border>

        <!-- Loading Overlay -->
        <Border Background="#CC000000" Grid.RowSpan="2"
                Visibility="{x:Bind ViewModel.IsBackupRunning, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}">
        </Border>
    </Grid>
</Page>
