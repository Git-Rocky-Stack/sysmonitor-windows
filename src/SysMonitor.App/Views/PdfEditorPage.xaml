<?xml version="1.0" encoding="utf-8"?>
<Page
    x:Class="SysMonitor.App.Views.PdfEditorPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    x:Name="ContentArea"
    Background="{StaticResource BackgroundBrush}">

    <Grid Padding="24">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Page Header Banner -->
        <Border Grid.Row="0" Background="#000000" Padding="24" Margin="-24,-24,-24,0">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Left: Header text -->
                <StackPanel Grid.Column="0" VerticalAlignment="Center" Spacing="4">
                    <TextBlock Text="PDF EDITOR" Style="{StaticResource PageHeaderStyle}"
                               Foreground="{StaticResource PrimaryBrush}" HorizontalAlignment="Left"/>
                    <TextBlock Text="Edit, Annotate &amp; Manage PDF Pages" Style="{StaticResource PageSubtitleStyle}"
                               Foreground="#AAFFFFFF" HorizontalAlignment="Left" Margin="0"/>
                </StackPanel>

                <!-- Center: STX.1 Home Logo -->
                <Image Grid.Column="1" Source="ms-appx:///Assets/Home_Logo.png"
                       Height="80" VerticalAlignment="Center" HorizontalAlignment="Center"
                       Stretch="Uniform"/>
            </Grid>
        </Border>

        <!-- Main Content Area -->
        <Grid Grid.Row="1" Margin="0,16,0,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="200"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="280"/>
            </Grid.ColumnDefinitions>

            <!-- Left Sidebar - Page Thumbnails -->
            <Border Grid.Column="0" Style="{StaticResource CardStyle}" Margin="0,0,8,0">
                <StackPanel Spacing="12" Padding="12">
                    <StackPanel Style="{StaticResource SectionHeaderWithAccentStyle}">
                        <Border Style="{StaticResource AccentBarStyle}" Height="16"/>
                        <TextBlock Text="PAGES" Style="{StaticResource SectionHeaderStyle}" FontSize="12" Margin="0"/>
                    </StackPanel>

                    <TextBlock Text="No document loaded" Style="{StaticResource CardSubtitleStyle}"
                               Visibility="{x:Bind ViewModel.HasDocument, Mode=OneWay, Converter={StaticResource InvertBoolToVisibilityConverter}}"/>

                    <!-- Page list without DataTemplate for initial testing -->
                    <ItemsControl ItemsSource="{x:Bind ViewModel.PageThumbnails, Mode=OneWay}"
                                  Visibility="{x:Bind ViewModel.HasDocument, Mode=OneWay}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Border Background="#202020" CornerRadius="4" Padding="8" Margin="0,2">
                                    <TextBlock Text="{Binding PageNumber}" Foreground="White"/>
                                </Border>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </StackPanel>
            </Border>

            <!-- Center - PDF Viewer -->
            <Grid Grid.Column="1" RowSpacing="8">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Top Toolbar -->
                <Border Grid.Row="0" Style="{StaticResource CardStyle}" Padding="8">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>

                        <!-- File Operations -->
                        <StackPanel Grid.Column="0" Orientation="Horizontal" Spacing="4">
                            <Button Command="{x:Bind ViewModel.OpenPdfCommand}" Style="{StaticResource OutlinedButtonStyle}"
                                    Padding="8" ToolTipService.ToolTip="Open PDF">
                                <FontIcon Glyph="&#xE8E5;" FontSize="14"/>
                            </Button>
                            <Button Command="{x:Bind ViewModel.SaveCommand}" Style="{StaticResource RedButtonStyle}"
                                    Padding="8" ToolTipService.ToolTip="Save PDF"
                                    IsEnabled="{x:Bind ViewModel.HasDocument, Mode=OneWay}">
                                <FontIcon Glyph="&#xE74E;" FontSize="14"/>
                            </Button>
                            <Border Width="1" Background="{StaticResource DividerBrush}" Margin="8,4"/>

                            <!-- Zoom Controls -->
                            <Button Command="{x:Bind ViewModel.ZoomOutCommand}" Padding="6" Background="Transparent"
                                    ToolTipService.ToolTip="Zoom Out">
                                <FontIcon Glyph="&#xE71F;" FontSize="12"/>
                            </Button>
                            <TextBlock Text="{x:Bind ViewModel.ZoomDisplay, Mode=OneWay}"
                                       VerticalAlignment="Center" Width="50" TextAlignment="Center"/>
                            <Button Command="{x:Bind ViewModel.ZoomInCommand}" Padding="6" Background="Transparent"
                                    ToolTipService.ToolTip="Zoom In">
                                <FontIcon Glyph="&#xE8A3;" FontSize="12"/>
                            </Button>
                            <Button Command="{x:Bind ViewModel.ResetZoomCommand}" Padding="6" Background="Transparent"
                                    ToolTipService.ToolTip="Reset Zoom">
                                <FontIcon Glyph="&#xE72C;" FontSize="12"/>
                            </Button>
                        </StackPanel>

                        <!-- Document Name -->
                        <TextBlock Grid.Column="1" Text="{x:Bind ViewModel.DocumentName, Mode=OneWay}"
                                   HorizontalAlignment="Center" VerticalAlignment="Center"
                                   Style="{StaticResource CardTitleStyle}"/>

                        <!-- Page Operations -->
                        <StackPanel Grid.Column="2" Orientation="Horizontal" Spacing="4"
                                    Visibility="{x:Bind ViewModel.HasDocument, Mode=OneWay}">
                            <Button Command="{x:Bind ViewModel.RotateCurrentPageCommand}" CommandParameter="-90"
                                    Padding="8" Background="Transparent" ToolTipService.ToolTip="Rotate Left">
                                <FontIcon Glyph="&#xE7AD;" FontSize="14"/>
                            </Button>
                            <Button Command="{x:Bind ViewModel.RotateCurrentPageCommand}" CommandParameter="90"
                                    Padding="8" Background="Transparent" ToolTipService.ToolTip="Rotate Right">
                                <FontIcon Glyph="&#xE7AD;" FontSize="14" RenderTransformOrigin="0.5,0.5">
                                    <FontIcon.RenderTransform>
                                        <ScaleTransform ScaleX="-1"/>
                                    </FontIcon.RenderTransform>
                                </FontIcon>
                            </Button>
                            <Border Width="1" Background="{StaticResource DividerBrush}" Margin="4"/>
                            <Button Command="{x:Bind ViewModel.MovePageUpCommand}" Padding="8" Background="Transparent"
                                    ToolTipService.ToolTip="Move Page Up">
                                <FontIcon Glyph="&#xE74A;" FontSize="14"/>
                            </Button>
                            <Button Command="{x:Bind ViewModel.MovePageDownCommand}" Padding="8" Background="Transparent"
                                    ToolTipService.ToolTip="Move Page Down">
                                <FontIcon Glyph="&#xE74B;" FontSize="14"/>
                            </Button>
                            <Button Command="{x:Bind ViewModel.DeleteCurrentPageCommand}" Padding="8"
                                    Background="#30F44336" ToolTipService.ToolTip="Delete Page">
                                <FontIcon Glyph="&#xE74D;" FontSize="14" Foreground="#F44336"/>
                            </Button>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- PDF Viewer Area -->
                <Border Grid.Row="1" Style="{StaticResource CardStyle}" Padding="0">
                    <Grid>
                        <!-- Empty State -->
                        <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="16"
                                    Visibility="{x:Bind ViewModel.HasDocument, Mode=OneWay, Converter={StaticResource InvertBoolToVisibilityConverter}}">
                            <FontIcon Glyph="&#xEA90;" FontSize="64" Foreground="{StaticResource TextTertiaryBrush}"/>
                            <TextBlock Text="No PDF Loaded" Style="{StaticResource CardTitleStyle}"
                                       HorizontalAlignment="Center"/>
                            <TextBlock Text="Click 'Open' to load a PDF file for editing"
                                       Style="{StaticResource CardSubtitleStyle}" HorizontalAlignment="Center"/>
                            <Button Command="{x:Bind ViewModel.OpenPdfCommand}" Style="{StaticResource RedButtonStyle}">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <FontIcon Glyph="&#xE8E5;" FontSize="14"/>
                                    <TextBlock Text="OPEN PDF"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>

                        <!-- PDF Page Display -->
                        <ScrollViewer HorizontalScrollBarVisibility="Auto" VerticalScrollBarVisibility="Auto"
                                      Visibility="{x:Bind ViewModel.HasDocument, Mode=OneWay}">
                            <Grid HorizontalAlignment="Center" VerticalAlignment="Center" Margin="20">
                                <!-- Page Image -->
                                <Border Background="White" BorderBrush="{StaticResource DividerBrush}" BorderThickness="1"
                                        CornerRadius="4">
                                    <Image Source="{x:Bind ViewModel.CurrentPageImage, Mode=OneWay, Converter={StaticResource BytesToImageConverter}}"
                                           Stretch="None" x:Name="PageImage"/>
                                </Border>

                                <!-- Annotation Canvas Overlay -->
                                <Canvas x:Name="AnnotationCanvas" Background="Transparent"
                                        PointerPressed="AnnotationCanvas_PointerPressed"
                                        PointerMoved="AnnotationCanvas_PointerMoved"
                                        PointerReleased="AnnotationCanvas_PointerReleased"/>
                            </Grid>
                        </ScrollViewer>

                        <!-- Loading Overlay -->
                        <Border Background="#80000000" Visibility="{x:Bind ViewModel.IsLoading, Mode=OneWay}">
                            <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center" Spacing="12">
                                <ProgressRing IsActive="True" Width="40" Height="40" Foreground="{StaticResource PrimaryBrush}"/>
                                <TextBlock Text="{x:Bind ViewModel.LoadingStatus, Mode=OneWay}" Foreground="White"/>
                            </StackPanel>
                        </Border>
                    </Grid>
                </Border>

                <!-- Page Navigation -->
                <Border Grid.Row="2" Style="{StaticResource CardStyle}" Padding="8"
                        Visibility="{x:Bind ViewModel.HasDocument, Mode=OneWay}">
                    <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Spacing="12">
                        <Button Command="{x:Bind ViewModel.PreviousPageCommand}" Padding="8" Background="Transparent"
                                IsEnabled="{x:Bind ViewModel.CurrentPageNumber, Mode=OneWay, Converter={StaticResource GreaterThanOneConverter}}">
                            <FontIcon Glyph="&#xE76B;" FontSize="14"/>
                        </Button>
                        <StackPanel Orientation="Horizontal" Spacing="4" VerticalAlignment="Center">
                            <TextBlock Text="Page" Style="{StaticResource CardSubtitleStyle}"/>
                            <NumberBox Value="{x:Bind ViewModel.CurrentPageNumber, Mode=TwoWay}"
                                       Minimum="1" Maximum="{x:Bind ViewModel.TotalPages, Mode=OneWay}"
                                       SpinButtonPlacementMode="Hidden" Width="60"/>
                            <TextBlock Text="of" Style="{StaticResource CardSubtitleStyle}"/>
                            <TextBlock Text="{x:Bind ViewModel.TotalPages, Mode=OneWay}"
                                       Style="{StaticResource CardTitleStyle}"/>
                        </StackPanel>
                        <Button Command="{x:Bind ViewModel.NextPageCommand}" Padding="8" Background="Transparent">
                            <FontIcon Glyph="&#xE76C;" FontSize="14"/>
                        </Button>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Right Sidebar - Annotation Tools -->
            <Border Grid.Column="2" Style="{StaticResource CardStyle}" Margin="8,0,0,0">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Spacing="16" Padding="12">
                        <!-- Annotation Tools Section -->
                        <StackPanel Spacing="8">
                            <StackPanel Style="{StaticResource SectionHeaderWithAccentStyle}">
                                <Border Style="{StaticResource AccentBarStyle}" Height="16"/>
                                <TextBlock Text="ANNOTATION TOOLS" Style="{StaticResource SectionHeaderStyle}" FontSize="12" Margin="0"/>
                            </StackPanel>

                            <StackPanel Spacing="4">
                                <Button Command="{x:Bind ViewModel.SelectToolCommand}" CommandParameter="Select"
                                        HorizontalAlignment="Stretch" Padding="12,8"
                                        Background="{x:Bind ViewModel.IsSelectToolActive, Mode=OneWay, Converter={StaticResource BoolToAccentBrushConverter}}">
                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                        <FontIcon Glyph="&#xEF20;" FontSize="16"/>
                                        <TextBlock Text="Select" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                                <Button Command="{x:Bind ViewModel.SelectToolCommand}" CommandParameter="Text"
                                        HorizontalAlignment="Stretch" Padding="12,8"
                                        Background="{x:Bind ViewModel.IsTextToolActive, Mode=OneWay, Converter={StaticResource BoolToAccentBrushConverter}}">
                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                        <FontIcon Glyph="&#xE8D2;" FontSize="16"/>
                                        <TextBlock Text="Text" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                                <Button Command="{x:Bind ViewModel.SelectToolCommand}" CommandParameter="Highlight"
                                        HorizontalAlignment="Stretch" Padding="12,8"
                                        Background="{x:Bind ViewModel.IsHighlightToolActive, Mode=OneWay, Converter={StaticResource BoolToAccentBrushConverter}}">
                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                        <FontIcon Glyph="&#xE7E6;" FontSize="16"/>
                                        <TextBlock Text="Highlight" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                                <Button Command="{x:Bind ViewModel.SelectToolCommand}" CommandParameter="Rectangle"
                                        HorizontalAlignment="Stretch" Padding="12,8"
                                        Background="{x:Bind ViewModel.IsRectangleToolActive, Mode=OneWay, Converter={StaticResource BoolToAccentBrushConverter}}">
                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                        <FontIcon Glyph="&#xE739;" FontSize="16"/>
                                        <TextBlock Text="Rectangle" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                                <Button Command="{x:Bind ViewModel.SelectToolCommand}" CommandParameter="Ellipse"
                                        HorizontalAlignment="Stretch" Padding="12,8"
                                        Background="{x:Bind ViewModel.IsEllipseToolActive, Mode=OneWay, Converter={StaticResource BoolToAccentBrushConverter}}">
                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                        <FontIcon Glyph="&#xEA3A;" FontSize="16"/>
                                        <TextBlock Text="Ellipse" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                                <Button Command="{x:Bind ViewModel.SelectToolCommand}" CommandParameter="Line"
                                        HorizontalAlignment="Stretch" Padding="12,8"
                                        Background="{x:Bind ViewModel.IsLineToolActive, Mode=OneWay, Converter={StaticResource BoolToAccentBrushConverter}}">
                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                        <FontIcon Glyph="&#xE762;" FontSize="16"/>
                                        <TextBlock Text="Line" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                                <Button Command="{x:Bind ViewModel.SelectToolCommand}" CommandParameter="Arrow"
                                        HorizontalAlignment="Stretch" Padding="12,8"
                                        Background="{x:Bind ViewModel.IsArrowToolActive, Mode=OneWay, Converter={StaticResource BoolToAccentBrushConverter}}">
                                    <StackPanel Orientation="Horizontal" Spacing="12">
                                        <FontIcon Glyph="&#xE759;" FontSize="16"/>
                                        <TextBlock Text="Arrow" VerticalAlignment="Center"/>
                                    </StackPanel>
                                </Button>
                            </StackPanel>
                        </StackPanel>

                        <!-- Tool Properties Section -->
                        <StackPanel Spacing="8" Visibility="{x:Bind ViewModel.HasDocument, Mode=OneWay}">
                            <StackPanel Style="{StaticResource SectionHeaderWithAccentStyle}">
                                <Border Style="{StaticResource AccentBarStyle}" Height="16"/>
                                <TextBlock Text="PROPERTIES" Style="{StaticResource SectionHeaderStyle}" FontSize="12" Margin="0"/>
                            </StackPanel>

                            <!-- Color Picker -->
                            <StackPanel Spacing="4">
                                <TextBlock Text="Color" Style="{StaticResource CardSubtitleStyle}"/>
                                <StackPanel Orientation="Horizontal" Spacing="4">
                                    <Button Click="ColorButton_Click" Tag="#FF0000" Background="#FF0000" Width="32" Height="32" CornerRadius="4"/>
                                    <Button Click="ColorButton_Click" Tag="#00FF00" Background="#00FF00" Width="32" Height="32" CornerRadius="4"/>
                                    <Button Click="ColorButton_Click" Tag="#0000FF" Background="#0000FF" Width="32" Height="32" CornerRadius="4"/>
                                    <Button Click="ColorButton_Click" Tag="#FFFF00" Background="#FFFF00" Width="32" Height="32" CornerRadius="4"/>
                                    <Button Click="ColorButton_Click" Tag="#FF00FF" Background="#FF00FF" Width="32" Height="32" CornerRadius="4"/>
                                    <Button Click="ColorButton_Click" Tag="#000000" Background="#000000" Width="32" Height="32" CornerRadius="4"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Stroke Width -->
                            <StackPanel Spacing="4">
                                <TextBlock Text="Stroke Width" Style="{StaticResource CardSubtitleStyle}"/>
                                <Slider Value="{x:Bind ViewModel.StrokeWidth, Mode=TwoWay}" Minimum="1" Maximum="10"/>
                            </StackPanel>

                            <!-- Text Properties (shown when text tool is active) -->
                            <StackPanel Spacing="8" Visibility="{x:Bind ViewModel.IsTextToolActive, Mode=OneWay}">
                                <TextBlock Text="Text Content" Style="{StaticResource CardSubtitleStyle}"/>
                                <TextBox Text="{x:Bind ViewModel.AnnotationText, Mode=TwoWay}"
                                         PlaceholderText="Enter text..."
                                         Style="{StaticResource SearchTextBoxStyle}"/>
                                <StackPanel Spacing="4">
                                    <TextBlock Text="Font Size" Style="{StaticResource CardSubtitleStyle}"/>
                                    <NumberBox Value="{x:Bind ViewModel.FontSize, Mode=TwoWay}"
                                               Minimum="8" Maximum="72" SpinButtonPlacementMode="Compact"/>
                                </StackPanel>
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <CheckBox Content="Bold" IsChecked="{x:Bind ViewModel.IsBold, Mode=TwoWay}"/>
                                    <CheckBox Content="Italic" IsChecked="{x:Bind ViewModel.IsItalic, Mode=TwoWay}"/>
                                </StackPanel>
                            </StackPanel>

                            <!-- Highlight Opacity (shown when highlight tool is active) -->
                            <StackPanel Spacing="4" Visibility="{x:Bind ViewModel.IsHighlightToolActive, Mode=OneWay}">
                                <TextBlock Text="Opacity" Style="{StaticResource CardSubtitleStyle}"/>
                                <Slider Value="{x:Bind ViewModel.AnnotationOpacity, Mode=TwoWay}" Minimum="0.1" Maximum="0.8"/>
                            </StackPanel>
                        </StackPanel>

                        <!-- Current Page Annotations (simplified) -->
                        <StackPanel Spacing="8" Visibility="{x:Bind ViewModel.HasDocument, Mode=OneWay}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>
                                <StackPanel Style="{StaticResource SectionHeaderWithAccentStyle}">
                                    <Border Style="{StaticResource AccentBarStyle}" Height="16"/>
                                    <TextBlock Text="ANNOTATIONS" Style="{StaticResource SectionHeaderStyle}" FontSize="12" Margin="0"/>
                                </StackPanel>
                                <Button Grid.Column="1" Command="{x:Bind ViewModel.ClearAnnotationsCommand}"
                                        Padding="6" Background="Transparent" ToolTipService.ToolTip="Clear All">
                                    <FontIcon Glyph="&#xE74D;" FontSize="12"/>
                                </Button>
                            </Grid>

                            <ItemsControl ItemsSource="{x:Bind ViewModel.CurrentAnnotations, Mode=OneWay}" MaxHeight="200">
                                <ItemsControl.ItemTemplate>
                                    <DataTemplate>
                                        <Border Background="#202020" CornerRadius="4" Padding="8" Margin="0,2">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="Auto"/>
                                                    <ColumnDefinition Width="*"/>
                                                </Grid.ColumnDefinitions>
                                                <FontIcon Glyph="{Binding Icon}" FontSize="14" VerticalAlignment="Center"/>
                                                <TextBlock Grid.Column="1" Text="{Binding TypeDisplay}" Margin="8,0"
                                                           VerticalAlignment="Center" Style="{StaticResource CardSubtitleStyle}"/>
                                            </Grid>
                                        </Border>
                                    </DataTemplate>
                                </ItemsControl.ItemTemplate>
                            </ItemsControl>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- Status Bar -->
        <Border Background="{x:Bind ViewModel.StatusColor, Mode=OneWay, Converter={StaticResource StringToBrushConverter}}"
                CornerRadius="8" Padding="16" Margin="24"
                Visibility="{x:Bind ViewModel.HasStatusMessage, Mode=OneWay}"
                VerticalAlignment="Bottom" HorizontalAlignment="Center" Grid.Row="1">
            <TextBlock Text="{x:Bind ViewModel.StatusMessage, Mode=OneWay}" Foreground="White" FontWeight="SemiBold"/>
        </Border>
    </Grid>
</Page>
